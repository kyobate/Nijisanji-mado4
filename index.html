<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Vtuberマルチ配信ビューワー</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    .player-container {
      margin-bottom: 20px;
    }
    #addBtn {
      margin: 20px 0;
    }
  </style>
</head>
<body>

  <h1>Vtuberマルチ配信ビューワー</h1>

  <button id="addBtn" onclick="addPlayer()" disabled>プレイヤーを追加</button>

  <div id="players"></div>

  <script>
    let playerCount = 0;
    const players = {};

    const vtubers = {
      "壱百満天原サロメ": "UCgIfLpQvelloDi8IuRsHWZQ",
      "剣持刀也": "UCv1fFr156jc65EMiLbaLImw",
      "葛葉": "UCmvkTTWeNzyOi8Xc8QKO8Pg",
      "月ノ美兎": "UC7fk0CB07ly8oSl0aqKkqFg"
    };

    const apiKey = "AIzaSyCAmqSIpleN4qSr62IASDADpfR2G-sXCv0";

    function addPlayer() {
      playerCount++;
      const playerId = 'player' + playerCount;

      const container = document.createElement('div');
      container.className = 'player-container';
      container.innerHTML = `
        <select onchange="changeVtuber('${playerId}', this.value)">
          <option value="">配信者を選択</option>
          ${Object.entries(vtubers).map(([name, id]) =>
            `<option value="${id}">${name}</option>`
          ).join('')}
        </select>
        <div id="${playerId}" style="width:480px; height:270px;"></div>
      `;

      document.getElementById('players').appendChild(container);

      players[playerId] = new YT.Player(playerId, {
        height: '270',
        width: '480',
        videoId: '',
        events: {
          'onReady': () => {
            console.log(`${playerId} is ready`);
          }
        }
      });
    }

    function changeVtuber(playerId, channelId) {
      if (!channelId) return;

      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`)
        .then(response => response.json())
        .then(data => {
          if (data.items && data.items.length > 0) {
            const videoId = data.items[0].id.videoId;
            players[playerId].loadVideoById(videoId);
          } else {
            alert('現在この配信者はライブをしていません。');
          }
        })
        .catch(error => {
          console.error('ライブ取得エラー:', error);
        });
    }

    function onYouTubeIframeAPIReady() {
      // APIが読み込まれたらボタンを使えるようにする
      document.getElementById("addBtn").disabled = false;
      console.log("YouTube Iframe API ready");
    }
  </script>

</body>
</html>
